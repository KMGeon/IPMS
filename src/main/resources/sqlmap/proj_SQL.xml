<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : xml파일은 여러개일 수 있음.
이를 구별하기 위한 식별 용도로 사용 -->
<mapper namespace="com.ipms.mapper.ProjMapper">

<!--프로젝트 생성 com.ipms.mapper.ProjMapper.projInsert-->




    <insert id="projInsert" parameterType="com.ipms.vo.ProjVO" >
        <selectKey order="BEFORE" keyProperty="projId" resultType="String">
            SELECT To_char(NVL(MAX(proj_id),0)+1) FROM proj
        </selectKey>
        INSERT INTO proj (
            proj_id,
            mem_code,
            proj_name,
            proj_strt_date,
            proj_end_date,
            proj_smry,
            proj_opn_whth,
            proj_creatn_date,
            proj_img_route,
            delete_whth
        ) VALUES (
            #{projId},
        (select mem_code from mem where mem_email =#{memEmail}),
            #{projName},
            #{projStrtDate},
            #{projEndDate},
            #{projSmry},
            'Y',
            sysdate,
            '/',
            '0'
        )
    </insert>


    <update id="insertProjMem" parameterType="java.util.List">
        <foreach collection="list" item="projMem" open="INSERT ALL "
                 close="SELECT * FROM SYS.DUAL" separator=" ">
            INTO  proj_mem(
            mem_code
            ,proj_id
            ,team_id
            ,prtpt_aprov_code
            ,refer_cts
            )
            VALUES
            (
            #{projMem.memCode}
            ,#{projMem.projId}
            ,'team1'
            ,'Y'
            ,'0'
            )
        </foreach>
    </update>
</mapper>

