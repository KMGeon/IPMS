<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ipms.main.newProject.mapper.ProjMapper">


    <!--전체 프로젝트  com.ipms.main.newProject.mapper.ProjMapper.listProj-->
    <select id="listProj"  resultType="com.ipms.main.newProject.vo.ProjVO">
        SELECT
            proj_id,
            mem_code,
            proj_name,
            proj_strt_date,
            proj_end_date,
            proj_smry,
            proj_opn_whth,
            proj_creatn_date,
            proj_img_route,
            delete_whth
        FROM
            proj
        order by proj_creatn_date
    </select>

    <!-- 프로젝트  com.ipms.main.newProject.mapper.ProjMapper.listProj-->
    <select id="detailPage"  resultType="com.ipms.main.newProject.vo.ProjVO">
        SELECT
            proj_id,
            mem_code,
            proj_name,
            proj_strt_date,
            proj_end_date,
            proj_smry,
            proj_opn_whth,
            proj_creatn_date,
            proj_img_route,
            delete_whth
        FROM
            proj
       where proj_id=#{projId}
    </select>


    <!--프로젝트 생성 com.ipms.main.newProject.mapper.ProjMapper.projInsert-->
    <insert id="projInsert" parameterType="com.ipms.main.newProject.vo.ProjVO">
        <selectKey order="BEFORE" keyProperty="projId" resultType="String">
            SELECT To_char( NVL(MAX(TO_NUMBER(proj_id)), 0) +1) FROM proj
        </selectKey>
        INSERT INTO proj (
        proj_id,
        mem_code,
        proj_name,
        proj_strt_date,
        proj_end_date,
        proj_smry,
        proj_opn_whth,
        proj_creatn_date,
        proj_img_route,
        delete_whth
        ) VALUES (
        #{projId},
        (select mem_code from mem where mem_email =#{memEmail}),
        #{projName},
        #{projStrtDate},
        #{projEndDate},
        #{projSmry},
        'Y',
        sysdate,
        '/',
        '0'
        )
    </insert>


    <!--프로젝트 팀 생성 com.ipms.main.newProject.mapper.ProjMapper.insertProTeam-->
    <insert id="insertProTeam" parameterType="com.ipms.main.newProject.vo.ProjTeamVO">
        INSERT INTO proj_team (proj_id,
                               team_id,
                               team_name,
                               team_smry)
        VALUES (#{projId},
                #{teamId},
                '1',
                '2')
    </insert>


    <!--프로젝트 멤버 생성 com.ipms.main.newProject.mapper.ProjMapper.insertProjMem-->
    <insert id="insertProjMem" parameterType="com.ipms.main.newProject.vo.ProjMemVO">
        insert into proj_mem(
          mem_code
        , proj_id
        , team_id
        , PRTPT_APROV_CODE
        , REFER_CTS
        )
        values (
        #{memCode}
        ,#{projId}
        ,#{teamId}
        , 'Y'
        , '0'
        )
    </insert>


    <!--프로젝트 수정 com.ipms.main.newProject.mapper.ProjMapper.projAuthInsert-->
    <insert id="projAuthInsert" parameterType="com.ipms.main.login.vo.MemberAuth" >
        INSERT INTO member_auth(mem_code,PROJ_ID,mem_auth)
        values
            (#{memCode},#{projId},#{memAuth})
    </insert>

    <delete id="authDelete" parameterType="string">
        delete from member_auth where mem_code = #{memCode}
    </delete>



</mapper>







